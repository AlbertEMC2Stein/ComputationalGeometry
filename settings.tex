\newcommand{\NN}{\ensuremath{\mathbb{N}}}
\newcommand{\RR}{\ensuremath{\mathbb{R}}}
\newcommand{\EE}{\ensuremath{\mathbb{E}}}
\newcommand{\LO}{\ensuremath{\mathcal{O}}}

\algnewcommand\Runtime[1]{\item[\textbf{Runtime:}] {#1}}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\newcommand{\Input}[1]{\Require{#1}}
\newcommand{\Output}[1]{\Ensure{#1}}

\DeclareMathOperator{\argmin}{argmin}
\DeclareMathOperator{\argmax}{argmax}

\setlength{\parindent}{0pt}

\renewcommand*{\labelitemi}{$\triangleright$}
\renewcommand*{\labelitemii}{$\triangleright$}
\renewcommand*{\labelenumi}{\textbf{\arabic*}.}

\makeatletter
\newenvironment{breakablealgorithm}
  {% \begin{breakablealgorithm}
   \begin{center}
     \refstepcounter{algorithm}% New algorithm
     \hrule height.8pt depth0pt \kern2pt% \@fs@pre for \@fs@ruled
     \renewcommand{\caption}[2][\relax]{% Make a new \caption
       {\raggedright\textbf{\ALG@name~\thealgorithm} ##2\par}%
       \ifx\relax##1\relax % #1 is \relax
         \addcontentsline{loa}{algorithm}{\protect\numberline{\thealgorithm}##2}%
       \else % #1 is not \relax
         \addcontentsline{loa}{algorithm}{\protect\numberline{\thealgorithm}##1}%
       \fi
       \kern2pt\hrule\kern2pt
     }
  }{% \end{breakablealgorithm}
     \kern2pt\hrule\relax% \@fs@post for \@fs@ruled
   \end{center}
  }
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\colorlet{defcolor}{Dandelion!30}
\colorlet{thmcolor}{Purple!30}
\colorlet{lmacolor}{LimeGreen!30}
\colorlet{prpcolor}{Turquoise!30}

\mdfsetup{skipabove=\topskip,skipbelow=\topskip}
\newcounter{content}[chapter]\setcounter{content}{0}

%%% Theorem-like environments
% Definition
\newenvironment{definition}[1][]{%
\stepcounter{content}%
\ifstrempty{#1}%
 {\mdfsetup{%
   frametitle={%
    \tikz[baseline=(current bounding box.east),outer sep=0pt]
    \node[anchor=east,rectangle,fill=defcolor]
         {\strut Definition~\thechapter.\thecontent};}}
 }%
{\mdfsetup{%
  frametitle={%
   \tikz[baseline=(current bounding box.east),outer sep=0pt]
   \node[anchor=east,rectangle,fill=defcolor]
        {\strut Definition~\thechapter.\thecontent~(#1)};}}%
 }%
\mdfsetup{innertopmargin=10pt,linecolor=defcolor,%
       linewidth=2pt,topline=true,
       frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
   \begin{mdframed}\relax%
}
{\end{mdframed}}

% Theorem
\newenvironment{theorem}[1][]{%
\stepcounter{content}%
\ifstrempty{#1}%
 {\mdfsetup{%
   frametitle={%
    \tikz[baseline=(current bounding box.east),outer sep=0pt]
    \node[anchor=east,rectangle,fill=thmcolor]
         {\strut Theorem~\thechapter.\thecontent};}}
 }%
{\mdfsetup{%
  frametitle={%
   \tikz[baseline=(current bounding box.east),outer sep=0pt]
   \node[anchor=east,rectangle,fill=thmcolor]
        {\strut Theorem~\thechapter.\thecontent~(#1)};}}%
 }%
\mdfsetup{innertopmargin=10pt,linecolor=thmcolor,%
       linewidth=2pt,topline=true,
       frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
   \begin{mdframed}[]\relax%
}
{\end{mdframed}}

% Lemma
\newenvironment{lemma}[1][]{%
\stepcounter{content}%
\ifstrempty{#1}%
 {\mdfsetup{%
   frametitle={%
    \tikz[baseline=(current bounding box.east),outer sep=0pt]
    \node[anchor=east,rectangle,fill=lmacolor]
         {\strut Lemma~\thechapter.\thecontent};}}
 }%
{\mdfsetup{%
  frametitle={%
   \tikz[baseline=(current bounding box.east),outer sep=0pt]
   \node[anchor=east,rectangle,fill=lmacolor]
        {\strut Lemma~\thechapter.\thecontent~(#1)};}}%
 }%
\mdfsetup{innertopmargin=10pt,linecolor=lmacolor,%
       linewidth=2pt,topline=true,
       frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
   \begin{mdframed}[]\relax%
}
{\end{mdframed}}

% Proposition
\newenvironment{proposition}{%
\stepcounter{content}%
\mdfsetup{%
  frametitle={%
  \tikz[baseline=(current bounding box.east),outer sep=0pt]
  \node[anchor=east,rectangle,fill=prpcolor]
        {\strut Proposition~\thechapter.\thecontent};}}%
\mdfsetup{innertopmargin=10pt,linecolor=prpcolor,%
       linewidth=2pt,topline=true,
       frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
   \begin{mdframed}[]\relax%
}
{\end{mdframed}}

%%% Other environments
% Outline
\newenvironment{outline}[1]{
  \ifstrempty{#1}%
  {\textbf{Outline:}}%
  {\textbf{Outline~(#1):}}%
}{}

% Remark
\newenvironment{remark}{\textbf{Remark:}}{}